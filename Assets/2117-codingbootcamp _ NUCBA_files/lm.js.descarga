!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}return o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,n){"use strict";var y=this&&this.__awaiter||function(i,a,c,s){return new(c||(c=Promise))(function(e,t){function n(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(n,r)}o((s=s.apply(i,a||[])).next())})},g=this&&this.__generator||function(n,r){var o,i,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(n,c)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},u=this;Object.defineProperty(t,"__esModule",{value:!0}),t.LinkMink=function(e){return{initTracking:initTracking(e),getReferralData:getReferralData(e),conversion:conversion(e)}};var initTracking=function(e){return function(h){return y(u,void 0,void 0,function(){var t,n,r,o,i,a,c,s,u,l,f,d,p;return g(this,function(e){switch(e.label){case 0:if(t=window.location.host,n=t.split("."),r=n.slice(-2),o="."+r.join("."),m("lmverify")&&(i=document.getElementsByTagName("body"),'<div style="position: fixed; bottom: 10px; padding: 2px 4px; left: 10px; background: #6d5de2; z-index: 9999; border-radius: 3px; font-size: 12px; color: #fff;">Your LinkMink script is running</div>',i[0]?i[0].insertAdjacentHTML("beforeend",'<div style="position: fixed; bottom: 10px; padding: 2px 4px; left: 10px; background: #6d5de2; z-index: 9999; border-radius: 3px; font-size: 12px; color: #fff;">Your LinkMink script is running</div>'):console.error("There is no element with id linkmink_element")),a=h&&h.cookie_lifetime?h.cookie_lifetime:2160,c=h&&h.param_name?h.param_name:"lmref",s=h&&h.meta_name?h.meta_name:"lm_meta",u=m(c)||"",l=m(s)||"",!u)return[3,8];e.label=1;case 1:return e.trys.push([1,7,,8]),f="string"==typeof u&&k(u)&&"cus_"===atob(u).slice(0,4)?"ref":"aff",[4,function(m,b,v){return y(this,void 0,void 0,function(){var t,n,r,o,i,a,c,s,u,l,f,d,p,h;return g(this,function(e){switch(e.label){case 0:t=w(),n=t.lmref;try{r=n&&!parseInt(+n)?JSON.parse(atob(n)).id:void 0}catch(e){r=void 0}return"aff"!==b?[3,4]:(i={tag:"V2"},(a=r)?[3,2]:[4,x("lead")]);case 1:a=e.sent(),e.label=2;case 2:return i.id=a,c={},[4,x("click")];case 3:return i.click=(c.id=e.sent(),c.source=document.referrer,c.contract={id:m},c.destination=document.location.origin+document.location.pathname,c.metadata=v||null,c),o=i,[3,12];case 4:if("ref"!==b)return[3,8];s=void 0;try{s={tag:b,customer_id:function(e){if(k(e))return atob(e);throw"This is not a base64 encoded string"}(m)}}catch(e){s={tag:b,customer_id:m},console.error("This LinkMink referral parameter is in an incorrect format",e)}return u={tag:"V3"},(l=r)?[3,6]:[4,x("lead")];case 5:l=e.sent(),e.label=6;case 6:return u.id=l,f={},[4,x("click")];case 7:return u.click=(f.id=e.sent(),f.referral_data=s,f.source=document.referrer,f.destination=document.location.origin+document.location.pathname,f.metadata=v||null,f),o=u,[3,12];case 8:return d={tag:"V2"},(p=r)?[3,10]:[4,x("lead")];case 9:p=e.sent(),e.label=10;case 10:return d.id=p,h={},[4,x("click")];case 11:d.click=(h.id=e.sent(),h.source=document.referrer,h.contract={id:m},h.destination=document.location.origin+document.location.pathname,h.metadata=v||null,h),o=d,e.label=12;case 12:return[2,o]}})})}(u,f,l)];case 2:d=e.sent(),function(e,t,n,r){var o="";if(n){var i=new Date;i.setTime(i.getTime()+60*n*60*1e3),o="; expires="+i.toUTCString()}new RegExp("localhost").exec(r)?document.cookie=e+"="+t+o+";path=/":document.cookie=e+"="+t+o+";domain="+r+";path=/"}("lmref",btoa(JSON.stringify(d)),a,o),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,function(r){return y(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:return t={method:"POST",credentials:"omit",body:JSON.stringify(r)},(n=new Request("https://app.linkmink.com/api/clicks",t)).headers.set("Content-Type","application/json"),[4,window.fetch(n)];case 1:return[2,e.sent()]}})})}(d)];case 4:return e.sent(),[3,6];case 5:return e.sent(),[3,6];case 6:return[3,8];case 7:return p=e.sent(),console.error("There seems to be a LinkMink referral URL parameter, however a cookie was not set: ",p),[3,8];case 8:return[2]}})})}},getReferralData=function(e){return function(e){var t=w().lmref;if(t){if(t&&(n=parseFloat(t),Boolean(!isNaN(n)&&isFinite(n))))return t;var n,r;try{r=JSON.parse(atob(t))}catch(e){console.error("When retrieving the cookie, this lmref cookie isn't in a supported format: ",e)}if(r&&"V3"===r.tag)try{return"ref"===r.click.referral_data.tag&&(r.click.referral_data.coupon_id=e?e.coupon:console.error("No coupon attached when expected.")),btoa(JSON.stringify(r))}catch(e){console.error("This LinkMink referral data was expected to be in v3 format but wasn't: ",e)}return t}}},conversion=function(s){return function(o,i,a,c){return y(u,void 0,void 0,function(){var t,n,r;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),(t=getReferralData(s)())?(n={email:o,type:i,enable_match:!0,status:a,livemode:c,lm_data:t},[4,fetch("https://app.linkmink.com/api/v0.1.0/conversions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+s},mode:"cors",body:JSON.stringify(n)})]):[2];case 1:return e.sent(),[3,3];case 2:return r=e.sent(),c||console.error("conversion error: ",r),l(r,"conversion error"),[3,3];case 3:return[2]}})})}},l=function(n,r){return y(u,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:"https://app.linkmink.com/api/prometheus";try{t={eventTime:JSON.stringify(new Date),message:JSON.stringify(n,["message","arguments","type","name"]),context:{reportLocation:{app_url:window.location.href}},serviceContext:{service:r}}}catch(e){t={eventTime:"",message:"CDN error when trying to log error",context:{reportLocation:{app_url:window.location.href}},serviceContext:{service:"unhandled error failure"}}}return[4,fetch("https://app.linkmink.com/api/prometheus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){return e}).catch(function(e){return e})];case 1:return e.sent(),[2]}})})};function k(e){try{return btoa(atob(e)).replace("=","")===e.replace("=","")}catch(e){return!1}}function w(){return document.cookie.split("; ").reduce(function(e,t){var n=t.split("="),r=n[0],o=n[1];return e[r]=o,e},{})}function m(e){var t,n,r=window.location.href,o=(t=r,(n=new RegExp("[?&]"+e+"=([^&#]*)","i").exec(t))?n[1]:void 0);return o||void 0}function x(l){return y(this,void 0,void 0,function(){var t,n,r,o,i,a,c,s,u;return g(this,function(e){switch(e.label){case 0:return"https:"!=window.location.protocol&&"localhost"!=window.location.hostname?(console.error("For leads and clicks to be tracked, LinkMink's tracking script must be run in a secure context (https vs. http)."),[2,null]):crypto&&crypto.subtle?(t=Math.round(62*Math.random()),n=Math.round(62*Math.random()),(r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("")).push(r[t]),r.push(r[n]),o=new Uint8Array(80),i=crypto.getRandomValues(o),c=Uint8Array.bind,[4,crypto.subtle.digest("SHA-1",i)]):[2,null];case 1:for(a=new(c.apply(Uint8Array,[void 0,e.sent()])),s="",u=0;u<a.length;u++)s+=r[a[u]%r.length];return[2,l+"_"+s]}})})}}])});